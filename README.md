# Rant System (name temporary)

## What is this

This is a system to organize my rant on every thing. It uses a proprietary file type (.rnt) to contain every rant.

## .rnt files

Rant files contains rant content (both text and assets) and versioning. 
They are a zip file that contains:
- `rnt_version`
- `metadata.json`
- `content[.txt/.md]`
- `assets`
    - `asset1.jpg`
    - `asset2.mp3`
    - ...
- `history`
    - `0000111231231234`
    - ...

`version` contains the version of the rnt, formatted in utf-8. For now the only value possible is "1.0" 

### 1.0

`metadata.json` contains a utf-8 formatted json object with basic info about the content. A skeleton is as follow:  
```   
{
    "title": "The title of the rant",
    "date": 0000111231231234, # this shold be equal to the last history element timestamp
    "format": "plaintext", # how content is formatted, "plaintext" or "markdown"
    "hash": "UJ42rd88iSQcorak65jh7aPgZL0y/17Omuo/7SJZzl0=", # this shold be equal to the last history element hash, as in the diffs field `last_hash`.
}
```

`content[.txt/.md]` contains the current content of the rant, encoded in utf-8. It should be always rebuildable from the history. The extension depends from the content type.

`assets` contains every file that's not text. The organization is unspecified.

`history` contains all the diffs from the creation of the file. They are utf-8 encoded json file, named as a 16 character unix-timestamp.
Every file contains three keys:
- `timestamp`: the timestamp
- `patches`: a list of the patches to apply, in order. The file is valid after **all** the changes are applied.
- `last_hash`: the hash of the last diff. Is the base64 encoded sha256 hash of the previous diff file, with the keys sorted and the whitespaces reduced to the minimum. If this is the first diff, this field is `null`. 

Every patch is represented by an object. The list enumerate changes to apply in sequence.  
The main field is `action`, it can be "creation", "version_change", "title_change", "format_change", "content_update", "asset_add", "asset_change", "asset_remove".
The specific fields are, dependant on `action`:
- "creation"
    - `version`: the initial content of `rnt_version`
    - `title`: the initial title
    - `format`: the initial format
- "version_change"
    - `new_version`
- "title_change"
    - `new_title`
- "format_change"
    - `new_format`: the new value for the format field. If absent is the same as before 
- "content_update"
    - `diffs`: a list of string, as generated by [python 3 difflib Differ.compare()](https://docs.python.org/3/library/difflib.html#difflib.Differ.compare), with the trailing '\n' removed.
- "asset_add"
    - `path`: the name and path of the new asset (eg "images/test.jpg" means the file "assets/images/test.jpg" was added)
    - `asset_hash`: the base64 encoded sha256 hash of the asset file content
- "asset_change"
    - `path`: the name and path of the changed asset (eg "images/test.jpg" means the file "assets/images/test.jpg" was changed)
    - `asset_old_hash`: the base64 encoded sha256 hash of the old asset file content
    - `asset_new_hash`: the base64 encoded sha256 hash of the new asset file content
- "asset_remove"
    - `path`: the name and path of the removed asset (eg "images/test.jpg" means the file "assets/images/test.jpg" was removed)
    - `asset_hash`: the base64 encoded sha256 hash of the asset file content
